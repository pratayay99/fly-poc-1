name: Get Fly App Image

on:
  workflow_dispatch:

jobs:
  get-image:
    name: Extract Image from Fly App Status
    runs-on: ubuntu-latest
    steps:
      - name: Set up Fly CLI
        uses: superfly/flyctl-actions/setup-flyctl@master

      - name: Get image from fly status
        run: |
          output=$(flyctl status --app fp-app)
          echo "Full status output:"
          echo "$output"

          image=$(echo "$output" | grep -E 'Image\s+=' | sed -E 's/Image\s+=\s+//')
          
          if [ -z "$image" ]; then
            echo "❌ Failed to extract image"
            exit 1
          fi

          echo "✅ Image used by fp-app: $image"
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
